<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RutgersBallUp - Basketball Pickup Games</title>
    <!-- Leaflet CSS for free OpenStreetMap -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background-color: #f5f5f5;
            line-height: 1.6;
        }

        .container {
            max-width: 400px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }

        .screen {
            display: none;
            padding: 24px;
            min-height: 100vh;
        }

        .screen.active {
            display: block;
        }

        .map-screen {
            padding: 0 !important;
        }

        .title {
            font-size: 48px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 8px;
            color: #FF6B35;
        }

        .subtitle {
            font-size: 18px;
            text-align: center;
            margin-bottom: 48px;
            color: #666;
        }

        .form {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .input {
            background: white;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 16px;
            border: 1px solid #ddd;
        }

        .button {
            background: #FF6B35;
            color: white;
            padding: 16px;
            border-radius: 8px;
            border: none;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.2s;
        }

        .button:hover {
            background: #e55a2b;
        }

        .button-outline {
            background: transparent;
            color: #FF6B35;
            border: 2px solid #FF6B35;
        }

        .button-outline:hover {
            background: #FF6B35;
            color: white;
        }

        .nav-header {
            display: flex;
            align-items: center;
            padding: 16px 24px;
            border-bottom: 1px solid #eee;
            margin: -24px -24px 24px -24px;
            background: white;
        }

        .back-btn {
            background: none;
            border: none;
            font-size: 18px;
            cursor: pointer;
            margin-right: 16px;
        }

        .nav-title {
            font-size: 20px;
            font-weight: bold;
            color: #333;
        }

        .welcome {
            font-size: 28px;
            font-weight: bold;
            color: #FF6B35;
            margin-bottom: 8px;
            text-align: center;
        }

        .action-button {
            background: white;
            padding: 20px;
            border-radius: 12px;
            border: none;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            cursor: pointer;
            margin-bottom: 16px;
            transition: transform 0.2s;
            text-align: center;
        }

        .action-button:hover {
            transform: translateY(-2px);
        }

        .action-icon {
            font-size: 40px;
            margin-bottom: 8px;
        }

        .action-title {
            font-size: 20px;
            font-weight: bold;
            color: #333;
            margin-bottom: 4px;
        }

        .action-description {
            font-size: 14px;
            color: #666;
        }

        .game-card {
            background: white;
            padding: 16px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 16px;
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .location-name {
            font-size: 18px;
            font-weight: bold;
            color: #333;
        }

        .game-time {
            font-size: 14px;
            color: #FF6B35;
            font-weight: 600;
        }

        .game-description {
            font-size: 14px;
            color: #666;
            margin-bottom: 12px;
            line-height: 1.4;
        }

        .game-details {
            display: flex;
            justify-content: space-between;
            margin-bottom: 16px;
            font-size: 12px;
            color: #888;
        }

        .skill-level {
            color: #FF6B35 !important;
            font-weight: 600;
            text-transform: capitalize;
        }

        .search-container {
            background: white;
            padding: 16px;
            border-bottom: 1px solid #eee;
            margin: -24px -24px 0 -24px;
        }

        .search-input {
            background: #f8f8f8;
            padding: 12px 16px;
            border-radius: 8px;
            border: none;
            width: 100%;
            font-size: 16px;
        }

        .view-toggle {
            display: flex;
            background: #f8f8f8;
            border-radius: 8px;
            padding: 2px;
            margin-top: 12px;
        }

        .toggle-btn {
            flex: 1;
            padding: 8px 16px;
            border: none;
            background: transparent;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.2s;
            color: #666;
        }

        .toggle-btn.active {
            background: #FF6B35;
            color: white;
        }

        .amenities-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 8px;
        }

        .amenity-chip {
            padding: 8px 16px;
            border-radius: 20px;
            background: white;
            border: 1px solid #ddd;
            cursor: pointer;
            font-size: 14px;
            color: #666;
            transition: all 0.2s;
        }

        .amenity-chip.selected {
            background: #FF6B35;
            border-color: #FF6B35;
            color: white;
            font-weight: 600;
        }

        .input-group {
            margin-bottom: 24px;
        }

        .label {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            display: block;
        }

        .textarea {
            height: 100px;
            resize: vertical;
        }

        /* Map Styles */
        .map-container {
            height: 400px;
            width: 100%;
            border-radius: 0;
            position: relative;
        }

        .map-header {
            padding: 16px 24px;
            background: white;
            border-bottom: 1px solid #eee;
            position: relative;
            z-index: 1000;
        }

        .map-controls {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }

        .location-btn {
            background: #4285f4;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .location-btn:hover {
            background: #3367d6;
        }

        .games-list {
            padding: 24px;
            max-height: calc(100vh - 200px);
            overflow-y: auto;
        }

        .error-message {
            background: #fee;
            color: #c33;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 16px;
            text-align: center;
        }

        .success-message {
            background: #efe;
            color: #393;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 16px;
            text-align: center;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .popup-content {
            min-width: 200px;
        }

        .popup-title {
            font-weight: bold;
            margin-bottom: 4px;
            color: #333;
        }

        .popup-description {
            font-size: 12px;
            color: #666;
            margin-bottom: 8px;
        }

        .popup-button {
            background: #FF6B35;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
        }

        .map-picker-container {
            height: 300px;
            margin: 16px 0;
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid #ddd;
        }

        .selected-location {
            background: #e8f5e8;
            padding: 12px;
            border-radius: 8px;
            margin: 16px 0;
            border: 1px solid #4CAF50;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Login Screen -->
        <div class="screen active" id="login-screen">
            <div style="display: flex; flex-direction: column; justify-content: center; min-height: 100vh;">
                <div class="title">üèÄ RutgersBallUp</div>
                <div class="subtitle">Find your next game</div>
                
                <div class="form">
                    <input type="email" class="input" placeholder="Email" id="login-email">
                    <input type="password" class="input" placeholder="Password" id="login-password">
                    <button class="button" onclick="login()">Sign In</button>
                    <button class="button button-outline" onclick="showScreen('register-screen')">Create Account</button>
                    <button class="button button-outline" onclick="showScreen('home-screen')" style="margin-top: 16px;">Try Demo (No Login)</button>
                </div>
            </div>
        </div>

        <!-- Register Screen -->
        <div class="screen" id="register-screen">
            <div class="nav-header">
                <button class="back-btn" onclick="showScreen('login-screen')">‚Üê</button>
                <div class="nav-title">Create Account</div>
            </div>
            
            <div class="title" style="font-size: 32px;">Join RutgersBallUp</div>
            <div class="subtitle">Connect with players in your area</div>
            
            <div class="form">
                <input type="email" class="input" placeholder="Email">
                <input type="text" class="input" placeholder="Username">
                <input type="password" class="input" placeholder="Password">
                <input type="password" class="input" placeholder="Confirm Password">
                <button class="button" onclick="register()">Create Account</button>
            </div>
        </div>

        <!-- Home Screen -->
        <div class="screen" id="home-screen">
            <div class="nav-header">
                <div class="nav-title">RutgersBallUp</div>
            </div>
            
            <div class="welcome">Welcome to RutgersBallUp! üèÄ</div>
            <div class="subtitle">What would you like to do?</div>
            
            <button class="action-button" onclick="showScreen('game-search-screen')">
                <div class="action-icon">üîç</div>
                <div class="action-title">Find Games</div>
                <div class="action-description">Search for pickup games near you</div>
            </button>
            
            <button class="action-button" onclick="showScreen('create-game-screen')">
                <div class="action-icon">üèÄ</div>
                <div class="action-title">Create Game</div>
                <div class="action-description">Organize a new pickup game</div>
            </button>
            
            <button class="action-button" onclick="showScreen('create-location-screen')">
                <div class="action-icon">üìç</div>
                <div class="action-title">Add Court</div>
                <div class="action-description">Add a new basketball court location</div>
            </button>
            
            <button class="action-button" onclick="showScreen('profile-screen')">
                <div class="action-icon">üë§</div>
                <div class="action-title">My Profile</div>
                <div class="action-description">View and edit your profile</div>
            </button>
            
            <button class="action-button" onclick="showScreen('my-games-screen')">
                <div class="action-icon">üìÖ</div>
                <div class="action-title">My Games</div>
                <div class="action-description">View your upcoming and past games</div>
            </button>
        </div>

        <!-- Game Search Screen -->
        <div class="screen map-screen" id="game-search-screen">
            <div class="map-header">
                <div class="nav-header" style="margin: 0; border: none; padding: 0;">
                    <button class="back-btn" onclick="showScreen('home-screen')">‚Üê</button>
                    <div class="nav-title">Find Games</div>
                </div>
                
                <div class="search-container" style="margin: 16px -24px 0 -24px; border: none;">
                    <input type="text" class="search-input" placeholder="Search games by location or description..." id="game-search-input">
                    <div class="view-toggle">
                        <button class="toggle-btn active" id="list-toggle" onclick="switchView('list')">List</button>
                        <button class="toggle-btn" id="map-toggle" onclick="switchView('map')">Map</button>
                    </div>
                </div>
            </div>
            
            <div id="games-list-view" class="games-list">
                <div class="loading">Loading games...</div>
            </div>
            
            <div id="games-map-view" class="map-container" style="display: none;">
                <div id="games-map"></div>
            </div>
        </div>

        <!-- Create Game Screen -->
        <div class="screen" id="create-game-screen">
            <div class="nav-header">
                <button class="back-btn" onclick="showScreen('home-screen')">‚Üê</button>
                <div class="nav-title">Create Game</div>
            </div>
            
            <div class="title" style="font-size: 28px;">Organize a Game</div>
            <div class="subtitle">Set up a pickup game for other players to join</div>
            
            <div class="form">
                <div class="input-group">
                    <label class="label">Select Court *</label>
                    <select class="input" id="game-location-select">
                        <option value="">Choose a court...</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label class="label">Game Title *</label>
                    <input type="text" class="input" id="game-title" placeholder="e.g., Pickup Game at Central Park">
                </div>
                
                <div class="input-group">
                    <label class="label">Date & Time *</label>
                    <input type="datetime-local" class="input" id="game-datetime">
                </div>
                
                <div class="input-group">
                    <label class="label">Max Players *</label>
                    <select class="input" id="game-max-players">
                        <option value="6">6 players</option>
                        <option value="8" selected>8 players</option>
                        <option value="10">10 players</option>
                        <option value="12">12 players</option>
                        <option value="14">14 players</option>
                        <option value="16">16 players</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label class="label">Skill Level</label>
                    <select class="input" id="game-skill-level">
                        <option value="">Any skill level</option>
                        <option value="beginner">Beginner</option>
                        <option value="intermediate">Intermediate</option>
                        <option value="advanced">Advanced</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label class="label">Description</label>
                    <textarea class="input textarea" id="game-description" placeholder="Describe your game, what to expect, etc."></textarea>
                </div>
                
                <button class="button" onclick="createGame()">Create Game</button>
            </div>
        </div>

        <!-- Create Location Screen -->
        <div class="screen" id="create-location-screen">
            <div class="nav-header">
                <button class="back-btn" onclick="showScreen('home-screen')">‚Üê</button>
                <div class="nav-title">Add Court</div>
            </div>
            
            <div class="title" style="font-size: 28px;">Add New Court</div>
            <div class="subtitle">Help other players discover great places to play</div>
            
            <div class="form">
                <div class="input-group">
                    <label class="label">Court Name *</label>
                    <input type="text" class="input" id="location-name" placeholder="e.g., Central Park Basketball Court">
                </div>
                
                <div class="input-group">
                    <label class="label">Address *</label>
                    <input type="text" class="input" id="location-address" placeholder="Enter the court address">
                    <button type="button" class="button button-outline" onclick="searchAddress()" style="margin-top: 8px; padding: 8px 16px; font-size: 14px;">Search Address</button>
                </div>
                
                <div class="input-group">
                    <label class="label">Select Location on Map *</label>
                    <div class="map-picker-container">
                        <div id="location-picker-map"></div>
                    </div>
                    <div id="selected-location-info" class="selected-location" style="display: none;">
                        <strong>Selected:</strong> <span id="selected-coords"></span>
                    </div>
                </div>
                
                <div class="input-group">
                    <label class="label">Description</label>
                    <textarea class="input textarea" id="location-description" placeholder="Describe the court (condition, features, etc.)"></textarea>
                </div>
                
                <div class="input-group">
                    <label class="label">Amenities</label>
                    <div class="amenities-grid">
                        <div class="amenity-chip" onclick="toggleAmenity(this)">Lighting</div>
                        <div class="amenity-chip" onclick="toggleAmenity(this)">Water Fountain</div>
                        <div class="amenity-chip" onclick="toggleAmenity(this)">Restrooms</div>
                        <div class="amenity-chip" onclick="toggleAmenity(this)">Parking</div>
                        <div class="amenity-chip" onclick="toggleAmenity(this)">Indoor</div>
                        <div class="amenity-chip selected" onclick="toggleAmenity(this)">Outdoor</div>
                        <div class="amenity-chip" onclick="toggleAmenity(this)">Multiple Courts</div>
                        <div class="amenity-chip" onclick="toggleAmenity(this)">Seating</div>
                    </div>
                </div>
                
                <button class="button" onclick="addCourt()">Add Court</button>
            </div>
        </div>

        <!-- Profile Screen -->
        <div class="screen" id="profile-screen">
            <div class="nav-header">
                <button class="back-btn" onclick="showScreen('home-screen')">‚Üê</button>
                <div class="nav-title">My Profile</div>
            </div>
            
            <div class="title" style="font-size: 28px;">Player Profile</div>
            <div class="subtitle">Manage your basketball profile</div>
            
            <div class="form">
                <div class="input-group">
                    <label class="label">Username</label>
                    <input type="text" class="input" id="profile-username" readonly value="Demo User">
                </div>
                
                <div class="input-group">
                    <label class="label">Email</label>
                    <input type="email" class="input" id="profile-email" readonly value="demo@ballup.com">
                </div>
                
                <div class="input-group">
                    <label class="label">Skill Level</label>
                    <select class="input" id="profile-skill-level">
                        <option value="beginner">Beginner</option>
                        <option value="intermediate" selected>Intermediate</option>
                        <option value="advanced">Advanced</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label class="label">Preferred Position</label>
                    <select class="input" id="profile-position">
                        <option value="">No preference</option>
                        <option value="Point Guard">Point Guard</option>
                        <option value="Shooting Guard" selected>Shooting Guard</option>
                        <option value="Small Forward">Small Forward</option>
                        <option value="Power Forward">Power Forward</option>
                        <option value="Center">Center</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label class="label">Bio</label>
                    <textarea class="input textarea" id="profile-bio" placeholder="Tell other players about yourself...">Love playing basketball and meeting new people!</textarea>
                </div>
                
                <button class="button" onclick="updateProfile()">Update Profile</button>
                <button class="button button-outline" onclick="logout()" style="margin-top: 16px;">Logout</button>
            </div>
        </div>

        <!-- My Games Screen -->
        <div class="screen" id="my-games-screen">
            <div class="nav-header">
                <button class="back-btn" onclick="showScreen('home-screen')">‚Üê</button>
                <div class="nav-title">My Games</div>
            </div>
            
            <div class="title" style="font-size: 28px;">My Games</div>
            <div class="subtitle">Your created and joined games</div>
            
            <div id="my-games-container">
                <div class="loading">Loading your games...</div>
            </div>
        </div>
    </div>

    <!-- Leaflet JavaScript for free OpenStreetMap -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <script>
        // Global variables
        let gamesMap = null;
        let locationPickerMap = null;
        let currentView = 'list';
        let selectedLocation = null;
        let userLocation = null;
        let gamesData = [];
        let locationsData = [];

        // Mock data for demo
        const mockGames = [
            {
                id: '1',
                title: 'Pickup Game at Central Park',
                description: 'Casual basketball game, all skill levels welcome!',
                dateTime: new Date(Date.now() + 2 * 60 * 60 * 1000).toISOString(),
                maxPlayers: 10,
                currentPlayers: 6,
                skillLevel: 'intermediate',
                status: 'scheduled',
                location: {
                    id: '1',
                    name: 'Central Park Basketball Court',
                    address: 'Central Park, New York, NY',
                    latitude: 40.7831,
                    longitude: -73.9712,
                    amenities: ['outdoor', 'free']
                }
            },
            {
                id: '2',
                title: 'Indoor Game at Community Center',
                description: 'Air conditioned court, competitive level',
                dateTime: new Date(Date.now() + 4 * 60 * 60 * 1000).toISOString(),
                maxPlayers: 8,
                currentPlayers: 4,
                skillLevel: 'advanced',
                status: 'scheduled',
                location: {
                    id: '2',
                    name: 'Downtown Community Center',
                    address: '123 Main St, New York, NY',
                    latitude: 40.7589,
                    longitude: -73.9851,
                    amenities: ['indoor', 'parking', 'restrooms']
                }
            },
            {
                id: '3',
                title: 'Beginner-Friendly Game',
                description: 'Perfect for new players to learn and have fun',
                dateTime: new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString(),
                maxPlayers: 12,
                currentPlayers: 8,
                skillLevel: 'beginner',
                status: 'scheduled',
                location: {
                    id: '3',
                    name: 'Riverside Park Court',
                    address: 'Riverside Dr, New York, NY',
                    latitude: 40.7951,
                    longitude: -73.9712,
                    amenities: ['outdoor', 'lighting', 'water fountain']
                }
            }
        ];

        const mockLocations = mockGames.map(game => game.location);

        // Initialize data
        gamesData = mockGames;
        locationsData = mockLocations;

        function showScreen(screenId) {
            // Hide all screens
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            
            // Show selected screen
            document.getElementById(screenId).classList.add('active');
            
            // Load data when entering specific screens
            if (screenId === 'game-search-screen') {
                loadGames();
            } else if (screenId === 'create-game-screen') {
                loadLocationsForGame();
            } else if (screenId === 'create-location-screen') {
                initLocationPicker();
            } else if (screenId === 'profile-screen') {
                loadUserProfile();
            } else if (screenId === 'my-games-screen') {
                loadMyGames();
            }
        }

        function switchView(view) {
            currentView = view;
            
            // Update toggle buttons
            document.getElementById('list-toggle').classList.toggle('active', view === 'list');
            document.getElementById('map-toggle').classList.toggle('active', view === 'map');
            
            // Show/hide views
            document.getElementById('games-list-view').style.display = view === 'list' ? 'block' : 'none';
            document.getElementById('games-map-view').style.display = view === 'map' ? 'block' : 'none';
            
            if (view === 'map') {
                setTimeout(() => initGamesMap(), 100);
            }
        }

        function initGamesMap() {
            if (gamesMap) {
                gamesMap.remove();
            }
            
            gamesMap = L.map('games-map').setView([40.7831, -73.9712], 13);
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors'
            }).addTo(gamesMap);
            
            // Add game markers
            gamesData.forEach(game => {
                if (game.location) {
                    const marker = L.marker([game.location.latitude, game.location.longitude])
                        .addTo(gamesMap);
                    
                    const popupContent = `
                        <div class="popup-content">
                            <div class="popup-title">${game.title}</div>
                            <div class="popup-description">${game.location.name}</div>
                            <div class="popup-description">Players: ${game.currentPlayers}/${game.maxPlayers}</div>
                            <div class="popup-description">Skill: ${game.skillLevel}</div>
                            <button class="popup-button" onclick="joinGame('${game.id}')">Join Game</button>
                        </div>
                    `;
                    
                    marker.bindPopup(popupContent);
                }
            });
            
            // Try to get user location
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition((position) => {
                    userLocation = [position.coords.latitude, position.coords.longitude];
                    L.marker(userLocation).addTo(gamesMap)
                        .bindPopup('Your Location')
                        .setIcon(L.icon({
                            iconUrl: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHZpZXdCb3g9IjAgMCAyMCAyMCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMTAiIGN5PSIxMCIgcj0iOCIgZmlsbD0iIzQyODVmNCIgc3Ryb2tlPSJ3aGl0ZSIgc3Ryb2tlLXdpZHRoPSIyIi8+CjxjaXJjbGUgY3g9IjEwIiBjeT0iMTAiIHI9IjMiIGZpbGw9IndoaXRlIi8+Cjwvc3ZnPgo=',
                            iconSize: [20, 20]
                        }));
                });
            }
        }

        function initLocationPicker() {
            setTimeout(() => {
                if (locationPickerMap) {
                    locationPickerMap.remove();
                }
                
                locationPickerMap = L.map('location-picker-map').setView([40.7831, -73.9712], 13);
                
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '¬© OpenStreetMap contributors'
                }).addTo(locationPickerMap);
                
                let selectedMarker = null;
                
                locationPickerMap.on('click', function(e) {
                    const lat = e.latlng.lat;
                    const lng = e.latlng.lng;
                    
                    selectedLocation = { latitude: lat, longitude: lng };
                    
                    if (selectedMarker) {
                        locationPickerMap.removeLayer(selectedMarker);
                    }
                    
                    selectedMarker = L.marker([lat, lng]).addTo(locationPickerMap);
                    
                    document.getElementById('selected-location-info').style.display = 'block';
                    document.getElementById('selected-coords').textContent = 
                        `${lat.toFixed(4)}, ${lng.toFixed(4)}`;
                    
                    // Reverse geocode to get address
                    reverseGeocode(lat, lng);
                });
            }, 100);
        }

        async function reverseGeocode(lat, lng) {
            try {
                const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}`);
                const data = await response.json();
                
                if (data.display_name) {
                    document.getElementById('location-address').value = data.display_name;
                }
            } catch (error) {
                console.error('Reverse geocoding failed:', error);
            }
        }

        async function searchAddress() {
            const address = document.getElementById('location-address').value;
            if (!address) {
                alert('Please enter an address to search');
                return;
            }
            
            try {
                const response = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(address)}&limit=1`);
                const data = await response.json();
                
                if (data.length > 0) {
                    const lat = parseFloat(data[0].lat);
                    const lng = parseFloat(data[0].lon);
                    
                    locationPickerMap.setView([lat, lng], 15);
                    
                    // Simulate a click to select this location
                    selectedLocation = { latitude: lat, longitude: lng };
                    
                    if (locationPickerMap.selectedMarker) {
                        locationPickerMap.removeLayer(locationPickerMap.selectedMarker);
                    }
                    
                    locationPickerMap.selectedMarker = L.marker([lat, lng]).addTo(locationPickerMap);
                    
                    document.getElementById('selected-location-info').style.display = 'block';
                    document.getElementById('selected-coords').textContent = `${lat.toFixed(4)}, ${lng.toFixed(4)}`;
                } else {
                    alert('Address not found. Please try a different search term.');
                }
            } catch (error) {
                console.error('Geocoding failed:', error);
                alert('Failed to search address. Please try again.');
            }
        }

        async function login() {
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            
            if (!email || !password) {
                alert('Please fill in all fields');
                return;
            }
            
            // For demo purposes, simulate successful login
            localStorage.setItem('user', JSON.stringify({
                id: 'demo-user',
                username: 'Demo User',
                email: email,
                skillLevel: 'intermediate'
            }));
            
            showMessage('Login successful!', 'success');
            setTimeout(() => showScreen('home-screen'), 1000);
        }

        async function register() {
            const email = document.querySelector('#register-screen input[type="email"]').value;
            const username = document.querySelector('#register-screen input[placeholder="Username"]').value;
            const password = document.querySelector('#register-screen input[placeholder="Password"]').value;
            const confirmPassword = document.querySelector('#register-screen input[placeholder="Confirm Password"]').value;
            
            if (!email || !username || !password || !confirmPassword) {
                alert('Please fill in all fields');
                return;
            }
            
            if (password !== confirmPassword) {
                alert('Passwords do not match');
                return;
            }
            
            // For demo purposes, simulate successful registration
            localStorage.setItem('user', JSON.stringify({
                id: 'demo-user',
                username: username,
                email: email,
                skillLevel: 'beginner'
            }));
            
            showMessage('Account created successfully!', 'success');
            setTimeout(() => showScreen('home-screen'), 1000);
        }

        function toggleAmenity(element) {
            element.classList.toggle('selected');
        }

        async function addCourt() {
            const name = document.getElementById('location-name').value;
            const address = document.getElementById('location-address').value;
            const description = document.getElementById('location-description').value;
            
            const selectedAmenities = Array.from(document.querySelectorAll('#create-location-screen .amenity-chip.selected'))
                .map(chip => chip.textContent);
            
            if (!name || !address || !selectedLocation) {
                alert('Please fill in the required fields and select a location on the map');
                return;
            }
            
            const newLocation = {
                id: Date.now().toString(),
                name,
                address,
                latitude: selectedLocation.latitude,
                longitude: selectedLocation.longitude,
                description,
                amenities: selectedAmenities
            };
            
            locationsData.push(newLocation);
            
            showMessage('Court added successfully!', 'success');
            
            // Clear form
            document.getElementById('location-name').value = '';
            document.getElementById('location-address').value = '';
            document.getElementById('location-description').value = '';
            document.getElementById('selected-location-info').style.display = 'none';
            selectedLocation = null;
            
            document.querySelectorAll('#create-location-screen .amenity-chip.selected').forEach(chip => {
                if (chip.textContent !== 'Outdoor') {
                    chip.classList.remove('selected');
                }
            });
            
            setTimeout(() => showScreen('home-screen'), 2000);
        }

        function loadGames() {
            const container = document.getElementById('games-list-view');
            container.innerHTML = '';
            
            if (gamesData.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">No games available. Create the first one!</p>';
                return;
            }
            
            gamesData.forEach(game => {
                const gameCard = document.createElement('div');
                gameCard.className = 'game-card';
                
                const gameTime = new Date(game.dateTime).toLocaleDateString('en-US', {
                    weekday: 'short',
                    month: 'short',
                    day: 'numeric',
                    hour: 'numeric',
                    minute: '2-digit',
                });
                
                gameCard.innerHTML = `
                    <div class="game-header">
                        <div class="location-name">${game.location?.name || 'Unknown Location'}</div>
                        <div class="game-time">${gameTime}</div>
                    </div>
                    <div class="game-description">${game.description || 'No description provided'}</div>
                    <div class="game-details">
                        <span>Players: ${game.currentPlayers}/${game.maxPlayers}</span>
                        <span class="skill-level">Skill: ${game.skillLevel || 'any'}</span>
                    </div>
                    <button class="button" onclick="joinGame('${game.id}')">Join Game</button>
                `;
                
                container.appendChild(gameCard);
            });
        }

        function joinGame(gameId) {
            const game = gamesData.find(g => g.id === gameId);
            if (game && game.currentPlayers < game.maxPlayers) {
                game.currentPlayers++;
                showMessage('Successfully joined the game!', 'success');
                loadGames();
                if (currentView === 'map' && gamesMap) {
                    initGamesMap();
                }
            } else {
                showMessage('Game is full or not found', 'error');
            }
        }

        function loadLocationsForGame() {
            const select = document.getElementById('game-location-select');
            select.innerHTML = '<option value="">Choose a court...</option>';
            
            locationsData.forEach(location => {
                const option = document.createElement('option');
                option.value = location.id;
                option.textContent = location.name;
                select.appendChild(option);
            });
        }

        function createGame() {
            const locationId = document.getElementById('game-location-select').value;
            const title = document.getElementById('game-title').value;
            const datetime = document.getElementById('game-datetime').value;
            const maxPlayers = parseInt(document.getElementById('game-max-players').value);
            const skillLevel = document.getElementById('game-skill-level').value;
            const description = document.getElementById('game-description').value;
            
            if (!locationId || !title || !datetime || !maxPlayers) {
                alert('Please fill in all required fields');
                return;
            }
            
            const location = locationsData.find(loc => loc.id === locationId);
            
            const newGame = {
                id: Date.now().toString(),
                title,
                description,
                dateTime: datetime,
                maxPlayers,
                currentPlayers: 1, // Creator joins automatically
                skillLevel: skillLevel || 'any',
                status: 'scheduled',
                location
            };
            
            gamesData.push(newGame);
            
            showMessage('Game created successfully!', 'success');
            
            // Clear form
            document.getElementById('game-location-select').value = '';
            document.getElementById('game-title').value = '';
            document.getElementById('game-datetime').value = '';
            document.getElementById('game-max-players').value = '8';
            document.getElementById('game-skill-level').value = '';
            document.getElementById('game-description').value = '';
            
            setTimeout(() => showScreen('home-screen'), 2000);
        }

        function loadUserProfile() {
            // Already populated with demo data in HTML
        }

        function updateProfile() {
            showMessage('Profile updated successfully!', 'success');
        }

        function loadMyGames() {
            const container = document.getElementById('my-games-container');
            
            // For demo, show some mock games
            const myGames = gamesData.slice(0, 2); // Show first 2 games as user's games
            
            container.innerHTML = '';
            
            if (myGames.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">No games yet. Create or join a game!</p>';
                return;
            }
            
            myGames.forEach(game => {
                const gameCard = document.createElement('div');
                gameCard.className = 'game-card';
                
                const gameTime = new Date(game.dateTime).toLocaleDateString('en-US', {
                    weekday: 'short',
                    month: 'short',
                    day: 'numeric',
                    hour: 'numeric',
                    minute: '2-digit',
                });
                
                gameCard.innerHTML = `
                    <div class="game-header">
                        <div class="location-name">${game.location?.name || 'Unknown Location'}</div>
                        <div class="game-time">${gameTime}</div>
                    </div>
                    <div class="game-description">${game.description || 'No description provided'}</div>
                    <div class="game-details">
                        <span>Players: ${game.currentPlayers}/${game.maxPlayers}</span>
                        <span class="skill-level">Status: Joined</span>
                    </div>
                    <button class="button button-outline" onclick="leaveGame('${game.id}')">Leave Game</button>
                `;
                
                container.appendChild(gameCard);
            });
        }

        function leaveGame(gameId) {
            if (confirm('Are you sure you want to leave this game?')) {
                const game = gamesData.find(g => g.id === gameId);
                if (game && game.currentPlayers > 0) {
                    game.currentPlayers--;
                    showMessage('Successfully left the game', 'success');
                    loadMyGames();
                }
            }
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                localStorage.removeItem('user');
                showScreen('login-screen');
            }
        }

        function showMessage(message, type) {
            const messageDiv = document.createElement('div');
            messageDiv.className = type === 'success' ? 'success-message' : 'error-message';
            messageDiv.textContent = message;
            
            // Insert at the top of the current screen
            const activeScreen = document.querySelector('.screen.active');
            activeScreen.insertBefore(messageDiv, activeScreen.firstChild);
            
            setTimeout(() => {
                messageDiv.remove();
            }, 3000);
        }

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            // Set minimum datetime to now
            const now = new Date();
            now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
            document.getElementById('game-datetime').min = now.toISOString().slice(0, 16);
            
            // Load initial games
            loadGames();
        });
    </script>
</body>
</html>